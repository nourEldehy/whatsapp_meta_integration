<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <record id="view_crm_lead_form_inherit_whatsapp_reply" model="ir.ui.view">
    <field name="name">crm.lead.form.inherit.whatsapp.reply</field>
    <field name="model">crm.lead</field>
    <!-- Correct base form for Odoo 13 -->
    <field name="inherit_id" ref="crm.crm_lead_view_form"/>
    <field name="arch" type="xml">
      <!-- 1) Inject the hidden field so attrs can reference it -->
      <xpath expr="//form/sheet" position="inside">
        <field name="reply_window_open" invisible="1"/>
      </xpath>

      <!-- 2) Add the button in the header (uses the field above) -->
      <xpath expr="//form/header" position="inside">
        <button name="%(whatsapp_meta_integration.action_whatsapp_reply_wizard)d"
                type="action"
                string="Reply via WhatsApp"
                class="oe_highlight"
                context="{'default_lead_id': active_id}"
                attrs="{'invisible': ['|', ('partner_id', '=', False), ('reply_window_open', '=', False)]}"/>
      </xpath>
    </field>
  </record>
</odoo>
